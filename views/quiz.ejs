<!DOCTYPE html>
<html lang="fr">
  <head>
    <title>LSF — Quiz</title>
    <%- include('partials/head') %>
  </head>
  <body>
    <%- include('partials/navbar') %>

    <!-- Header -->
    <header class="max-w-5xl mx-auto px-4 py-8">
      <h2
        class="text-3xl md:text-4xl font-bold text-[#00a8a3] mb-8 text-center"
      >
        Quiz
      </h2>
      <p class="mt-1 text-neutral-700 text-sm mb-8 text-center">
        Testez vos connaissances en LSF
      </p>
    </header>

    <!-- Quiz -->
    <main class="max-w-5xl mx-auto px-4 pb-16">
      <div class="grid md:grid-cols-2 gap-6">
        <% questions.forEach((q, idx)=>{ %>
        <section
          class="rounded-2xl border bg-white p-4 shadow"
          data-id="<%= q.id %>"
        >
          <h2 class="font-semibold text-[#f46b5e] mb-3">
            Question <%= idx + 1 %>
          </h2>

          <div
            class="rounded-xl overflow-hidden border-2 border-[#00a8a3] shadow-md"
          >
            <video
              class="w-full aspect-video"
              src="<%= q.video %>"
              controls
              preload="metadata"
            >
              Votre navigateur ne supporte pas la lecture de vidéos.
            </video>
          </div>

          <div class="mt-4">
            <label class="block text-sm text-neutral-700 mb-1"
              >Ta réponse :</label
            >
            <input
              type="text"
              class="answer-input w-full rounded-lg border px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#00a8a3] hover:border-[#00a8a3] transition"
              placeholder="Écris le mot"
              data-answer="<%= q.answer %>"
            />
          </div>

          <div class="mt-4 flex items-center gap-3">
            <button
              class="btn-check rounded-lg bg-[#00a8a3] px-4 py-2 text-white text-sm font-semibold hover:bg-[#00928e]"
            >
              Vérifier
            </button>
            <button
              class="btn-reset rounded-lg border px-3 py-2 text-sm bg-white hover:border-[#00a8a3]"
            >
              Effacer
            </button>
          </div>

          <p class="mt-3 hidden text-sm font-medium result"></p>
        </section>
        <% }) %>
      </div>

      <div
        class="mt-8 rounded-2xl border bg-white p-4 shadow flex items-center justify-between"
      >
        <p class="text-sm">
          Score : <strong id="score">0 / <%= questions.length %></strong>
        </p>
        <button
          id="btn-reset-all"
          class="rounded-lg border px-4 py-2 bg-white hover:border-[#00a8a3] text-sm"
        >
          Tout recommencer
        </button>
      </div>
    </main>

    <script>
      const cards = document.querySelectorAll("section[data-id]");
      let score = 0;
      const total = cards.length;

      function updateScore() {
        document.getElementById("score").textContent = `${score} / ${total}`;
      }

      cards.forEach((card) => {
        const input = card.querySelector(".answer-input");
        const result = card.querySelector(".result");
        const btnCheck = card.querySelector(".btn-check");
        const btnReset = card.querySelector(".btn-reset");
        const correctAnswer = input.dataset.answer;
        let isCorrect = false;

        btnCheck.addEventListener("click", () => {
          const userAnswer = input.value.trim().toLowerCase();
          isCorrect = userAnswer === correctAnswer;

          input.classList.remove(
            "ring-2",
            "ring-red-300",
            "ring-[#00a8a3]",
            "bg-red-50",
            "bg-[#00a8a3]/10",
            "border-red-300",
            "border-[#00a8a3]"
          );

          if (isCorrect) {
            input.classList.add(
              "ring-2",
              "ring-[#00a8a3]",
              "bg-[#00a8a3]/10",
              "border-[#00a8a3]"
            );
            result.textContent = "✅ Correct !";
            result.className = "mt-3 text-sm font-medium text-green-700";
            score++;
          } else {
            input.classList.add(
              "ring-2",
              "ring-red-300",
              "bg-red-50",
              "border-red-300"
            );
            result.textContent = "❌ Incorrect.";
            result.className = "mt-3 text-sm font-medium text-red-700";
          }

          result.classList.remove("hidden");
          updateScore();
        });

        btnReset.addEventListener("click", () => {
          input.value = "";
          input.classList.remove(
            "ring-2",
            "ring-red-300",
            "ring-[#00a8a3]",
            "bg-red-50",
            "bg-[#00a8a3]/10",
            "border-red-300",
            "border-[#00a8a3]"
          );
          result.classList.add("hidden");
          if (isCorrect) {
            score--;
            isCorrect = false;
            updateScore();
          }
        });
      });

      document.getElementById("btn-reset-all").addEventListener("click", () => {
        cards.forEach((card) => card.querySelector(".btn-reset").click());
        score = 0;
        updateScore();
      });

      updateScore();
    </script>
    <%- include('partials/footer') %>
  </body>
</html>
